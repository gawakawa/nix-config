name: Cache nixpkgs

on:
  workflow_dispatch:
    inputs:
      installable:
        description: "Nix installable (e.g., github:NixOS/nixpkgs/<rev>#swift)"
        required: true
        type: string
      platform:
        description: "Runner platform"
        required: true
        type: choice
        options:
          - macos-latest
          - ubuntu-latest

jobs:
  build:
    runs-on: ${{ inputs.platform }}
    timeout-minutes: 90
    steps:
      - uses: cachix/install-nix-action@v31
        with:
          github_access_token: ${{ secrets.GITHUB_TOKEN }}

      - uses: cachix/cachix-action@v16
        with:
          name: gawakawa
          authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}

      - run: nix build "${{ inputs.installable }}"
